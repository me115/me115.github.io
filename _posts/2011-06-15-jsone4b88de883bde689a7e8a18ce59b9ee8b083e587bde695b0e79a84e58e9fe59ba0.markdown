---
author: me115wp
comments: true
date: 2011-06-15 15:15:21+00:00
layout: post
link: http://blog.me115.com/2011/06/155
slug: json%e4%b8%8d%e8%83%bd%e6%89%a7%e8%a1%8c%e5%9b%9e%e8%b0%83%e5%87%bd%e6%95%b0%e7%9a%84%e5%8e%9f%e5%9b%a0
title: JSon不能执行回调函数的原因
wordpress_id: 155
categories:
- WEB开发
tags:
- JSON
---

通过

 

$.getJSON(url,function (data) {

 

｝函数调用JSON服务，回调函数没能正确执行的主要原因就是服务器返回的JSON格式不正确，

 

具体表现在：

 

1.Response.ContenType没有正确设置：

 

context.Response.ContentType = "application/json"; （c#环境)

 

2.JSON格式组装错误。

 

对于第2点很容易犯错，由于服务端JSON字符串基本都是从数据库读出的字段拼成，如果不注意控制字段的格式，就可能造成最后返回的并非JSON串。

 

例如：

 
    
                foreach(DataRow dr in dt.Rows){
                    content += string.Format("{{"Id":"{0}","Title":"{1}","TitleShort":"{2}","PubDate":"{3}"}},", dr["id"].ToString(), dr["Title"].ToString().Replace(""", ""), dr["TitleShort"].ToString().Replace(""", ""), dr["PubDate"].ToString());
                }





对于以上组装JSON字串的代码，最重要的就是对”的控制，如果读出的字段中有”而没有去掉，则会破坏JSON格式，客户端就不会认为是一个JSON返回报，从而不会激发回调函数。





JSON虽好用，但其对语法格式控制过于严格，是其弊端之一。





OVER
